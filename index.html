<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>restful.io by mvallerie</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>restful.io</h1>
        <p>HTTP-like realtime routing module for NodeJS built on top of socket.io</p>

        <p class="view"><a href="https://github.com/mvallerie/restful.io">View the Project on GitHub <small>mvallerie/restful.io</small></a></p>


        <ul>
          <li><a href="https://github.com/mvallerie/restful.io/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/mvallerie/restful.io/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/mvallerie/restful.io">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="restfulio" class="anchor" href="#restfulio" aria-hidden="true"><span class="octicon octicon-link"></span></a>restful.io</h1>

<p>restful.io is a micro framework built on the shoulders of <a href="http://socket.io">socket.io</a>. It was designed to get HTTP possibilities, without using HTTP itself. By using socket.io, transport layer is made completely abstract.</p>

<p>I started this project because i needed a simple way to manage realtime routing on the server side. I do believe that a very light client (pure HTML and JS), communicating with the server layer using realtime technologies is a very good and extremely portable paradigm.</p>

<h2>
<a id="inspirations" class="anchor" href="#inspirations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Inspirations</h2>

<ul>
<li><a href="https://github.com/playframework/playframework">Play Framework 2</a></li>
<li><a href="https://github.com/techpines/express.io">Express.io</a></li>
<li>RESTful architectures</li>
<li><a href="http://fr.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a></li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p><code>npm install --save restful.io</code></p>

<h2>
<a id="main-features" class="anchor" href="#main-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Main features</h2>

<ul>
<li>Routing system</li>
<li>Session management</li>
<li>Client API (needs to be improved)</li>
<li>File upload (using <a href="https://www.npmjs.com/package/socket.io-stream">socket.io-stream</a>)</li>
</ul>

<h2>
<a id="what-does-it-look-like" class="anchor" href="#what-does-it-look-like" aria-hidden="true"><span class="octicon octicon-link"></span></a>What does it look like</h2>

<p>Below is a quick presentation of the module in Coffeescript. You may check examples folder (currently <strong><em>NOT</em></strong> up to date) and test (currently up to date) folder for more.</p>

<h3>
<a id="routing" class="anchor" href="#routing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Routing</h3>

<div class="highlight highlight-coffeescript"><pre><span class="pl-v"><span class="pl-v">io <span class="pl-k">=</span></span></span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">'</span>socket.io<span class="pl-pds">'</span></span>)(http)
<span class="pl-v"><span class="pl-v">RestfulRouter <span class="pl-k">=</span></span></span> <span class="pl-s3">require</span> <span class="pl-s1"><span class="pl-pds">"</span>restful.io<span class="pl-pds">"</span></span>

<span class="pl-v"><span class="pl-v">controllers <span class="pl-k">=</span></span></span> {
  <span class="pl-v"><span class="pl-v">UserController:</span></span> {
    <span class="pl-en">findAll</span><span class="pl-k">:</span><span class="pl-vpf"> <span class="pl-vpf">(route)</span></span> <span class="pl-st"><span class="pl-st">-&gt;</span></span>
      route.OK(<span class="pl-s1"><span class="pl-pds">"</span>All users<span class="pl-pds">"</span></span>)
    <span class="pl-en">create</span><span class="pl-k">:</span><span class="pl-vpf"> <span class="pl-vpf">(route, user)</span></span> <span class="pl-st"><span class="pl-st">-&gt;</span></span>
      route.OK(<span class="pl-s1"><span class="pl-pds">"</span>User <span class="pl-s2"><span class="pl-pse">#{</span>user.id<span class="pl-pse">}</span></span> has been created<span class="pl-pds">"</span></span>)
  }
}

<span class="pl-v"><span class="pl-v">router <span class="pl-k">=</span></span></span> <span class="pl-k">new</span> <span class="pl-en">RestfulRouter</span>(controllers, {
  <span class="pl-v"><span class="pl-v">GET:</span></span> [
    {
      <span class="pl-v"><span class="pl-v">uri:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>/user<span class="pl-pds">"</span></span>
      <span class="pl-v"><span class="pl-v">to:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>UserController.findAll()<span class="pl-pds">"</span></span>
      <span class="pl-v"><span class="pl-v">public:</span></span> <span class="pl-c1">true</span>
    }
  ]
  <span class="pl-v"><span class="pl-v">PUT:</span></span> [
    {
      <span class="pl-v"><span class="pl-v">uri:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>/user<span class="pl-pds">"</span></span>
      <span class="pl-v"><span class="pl-v">to:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>UserController.create(p:user)<span class="pl-pds">"</span></span>
      <span class="pl-v"><span class="pl-v">public:</span></span> <span class="pl-c1">true</span>
    }
  ]
}, <span class="pl-c1">true</span>)

router.start(io)</pre></div>

<h3>
<a id="session-management" class="anchor" href="#session-management" aria-hidden="true"><span class="octicon octicon-link"></span></a>Session management</h3>

<p>No "public" attributes for routes. Those routes are considered as "private", which means you need a valid session to access them. When you will get it, it will be automagically injected on private routes.</p>

<div class="highlight highlight-coffeescript"><pre><span class="pl-v"><span class="pl-v">controllers <span class="pl-k">=</span></span></span> {
  <span class="pl-v"><span class="pl-v">UserController:</span></span> {
    <span class="pl-en">login</span><span class="pl-k">:</span><span class="pl-vpf"> <span class="pl-vpf">(route, credentials)</span></span> <span class="pl-st"><span class="pl-st">-&gt;</span></span>
      route.withNewSession({<span class="pl-v"><span class="pl-v">username:</span></span> credentials.username}).OK(<span class="pl-s1"><span class="pl-pds">"</span>You are now logged in<span class="pl-pds">"</span></span>)
    <span class="pl-en">me</span><span class="pl-k">:</span><span class="pl-vpf"> <span class="pl-vpf">(route, session)</span></span> <span class="pl-st"><span class="pl-st">-&gt;</span></span>
      route.OK(<span class="pl-s1"><span class="pl-pds">"</span>Welcome back <span class="pl-s2"><span class="pl-pse">#{</span>session.username<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>)
  }
}

<span class="pl-v"><span class="pl-v">router <span class="pl-k">=</span></span></span> <span class="pl-k">new</span> <span class="pl-en">RestfulRouter</span>(controllers, {
  <span class="pl-v"><span class="pl-v">POST:</span></span> [
    {
      <span class="pl-v"><span class="pl-v">uri:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>/login<span class="pl-pds">"</span></span>
      <span class="pl-v"><span class="pl-v">to:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>UserController.login(p:credentials)<span class="pl-pds">"</span></span>
      <span class="pl-v"><span class="pl-v">public:</span></span> <span class="pl-c1">true</span>
    }
  ]
  <span class="pl-v"><span class="pl-v">GET:</span></span> [
    {
      <span class="pl-v"><span class="pl-v">uri:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>/me<span class="pl-pds">"</span></span>
      <span class="pl-v"><span class="pl-v">to:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>UserController.me()<span class="pl-pds">"</span></span>
    }
  ]
}, <span class="pl-c1">true</span>)

router.start(io)</pre></div>

<h3>
<a id="client-api" class="anchor" href="#client-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Client API</h3>

<p>On the client side, you may create this file :</p>

<div class="highlight highlight-coffeescript"><pre><span class="pl-v"><span class="pl-v">io <span class="pl-k">=</span></span></span> <span class="pl-s3">require</span> <span class="pl-s1"><span class="pl-pds">'</span>socket.io-client<span class="pl-pds">'</span></span>
<span class="pl-v"><span class="pl-v">ss <span class="pl-k">=</span></span></span> <span class="pl-s3">require</span> <span class="pl-s1"><span class="pl-pds">'</span>socket.io-stream<span class="pl-pds">'</span></span>

<span class="pl-en">module.exports </span><span class="pl-k">=</span><span class="pl-vpf"> <span class="pl-vpf">(callback)</span></span> <span class="pl-st"><span class="pl-st">-&gt;</span></span>
  <span class="pl-v"><span class="pl-v">socket <span class="pl-k">=</span></span></span> io(<span class="pl-s1"><span class="pl-pds">'</span>http://yourdomain.com:1234<span class="pl-pds">'</span></span>)
  socket.on <span class="pl-s1"><span class="pl-pds">'</span>connect<span class="pl-pds">'</span></span>, <span class="pl-vpf">()</span> <span class="pl-st">-&gt;</span>
    socket.emit(<span class="pl-s1"><span class="pl-pds">'</span>GET:/api<span class="pl-pds">'</span></span>)

    socket.on <span class="pl-s1"><span class="pl-pds">'</span>GET:RESULT<span class="pl-pds">'</span></span>, <span class="pl-vpf">(apiSrc)</span> <span class="pl-st">-&gt;</span>
      <span class="pl-v"><span class="pl-v">API <span class="pl-k">=</span></span></span> <span class="pl-s3">eval</span>(apiSrc.data)(socket, ss, <span class="pl-c1">true</span>)
      callback(API)</pre></div>

<p>Then :</p>

<div class="highlight highlight-coffeescript"><pre><span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">"</span>./yourfile.coffee<span class="pl-pds">"</span></span>) <span class="pl-vpf">(API)</span> <span class="pl-st">-&gt;</span>
  <span class="pl-c"># Feel free to use API object :)</span>
  API.POST <span class="pl-s1"><span class="pl-pds">'</span>/login<span class="pl-pds">'</span></span>, {<span class="pl-v"><span class="pl-v">credentials:</span></span> {<span class="pl-v"><span class="pl-v">username:</span></span> <span class="pl-s1"><span class="pl-pds">'</span>foobar<span class="pl-pds">'</span></span>}}, <span class="pl-vpf">(result)</span> <span class="pl-st">-&gt;</span>
    <span class="pl-c"># Here we set the "token" (session id)</span>
    <span class="pl-v"><span class="pl-v">API.token <span class="pl-k">=</span></span></span> result.headers.token
    API.GET <span class="pl-s1"><span class="pl-pds">'</span>/me<span class="pl-pds">'</span></span>, {}, <span class="pl-vpf">(result)</span> <span class="pl-st">-&gt;</span>
      <span class="pl-en">console</span>.<span class="pl-s3">log</span> result.data</pre></div>

<h3>
<a id="file-upload" class="anchor" href="#file-upload" aria-hidden="true"><span class="octicon octicon-link"></span></a>File upload</h3>

<p>TODO</p>

<h2>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span class="octicon octicon-link"></span></a>API</h2>

<h3>
<a id="server" class="anchor" href="#server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server</h3>

<h5>
<a id="route-object" class="anchor" href="#route-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Route object</h5>

<table>
<thead>
<tr>
<th>Method</th>
<th>Parameters</th>
<th>Effect</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>OK</td>
<td>data: *</td>
<td>Sends back data to the client with a 200 result</td>
<td>route.OK({message: "done"})</td>
</tr>
<tr>
<td>FORBIDDEN</td>
<td>err: *</td>
<td>Sends back err to the client with a 403 result</td>
<td>route.FORBIDDEN("Error !!")</td>
</tr>
<tr>
<td>ISE</td>
<td>err: *</td>
<td>Sends back err to the client with a 500 result</td>
<td>route.ISE("Error !!")</td>
</tr>
<tr>
<td>NOT_FOUND</td>
<td>err: *</td>
<td>Sends back err to the client with a 404 result</td>
<td>route.NOT_FOUND("Error !!")</td>
</tr>
</tbody>
</table>

<h5>
<a id="result-object" class="anchor" href="#result-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Result object</h5>

<table>
<thead>
<tr>
<th>Property</th>
<th>Possible values</th>
</tr>
</thead>
<tbody>
<tr>
<td>status</td>
<td>200, 403, 500, 404</td>
</tr>
<tr>
<td>data</td>
<td>any string</td>
</tr>
<tr>
<td>headers</td>
<td>JS object, used for token</td>
</tr>
</tbody>
</table>

<h3>
<a id="client" class="anchor" href="#client" aria-hidden="true"><span class="octicon octicon-link"></span></a>Client</h3>

<h5>
<a id="api-object" class="anchor" href="#api-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>API object</h5>

<p>API object is automatically generated from your routes. Basically, the way to call a route is :</p>

<div class="highlight highlight-coffeescript"><pre>API.METHOD <span class="pl-s1"><span class="pl-pds">'</span>/route/you.want<span class="pl-pds">'</span></span>, {<span class="pl-v"><span class="pl-v">param:</span></span><span class="pl-s1"><span class="pl-pds">"</span>foobar<span class="pl-pds">"</span></span>}, <span class="pl-vpf">(result)</span> <span class="pl-st">-&gt;</span>
  <span class="pl-c"># Use the result here</span></pre></div>

<p>The only special property you have to worry about is "token" which is your session id.</p>

<h2>
<a id="tests" class="anchor" href="#tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tests</h2>

<div class="highlight highlight-shell"><pre>npm <span class="pl-s3">test</span></pre></div>

<h2>
<a id="warranty" class="anchor" href="#warranty" aria-hidden="true"><span class="octicon octicon-link"></span></a>Warranty</h2>

<p>restful.io is currently under heavy development. I'm building this project for myself and i try to make the code as clean as possible (which is far away from now :)). Feel free to submit a PR. Same for this README.</p>

<h2>
<a id="currently-working-on" class="anchor" href="#currently-working-on" aria-hidden="true"><span class="octicon octicon-link"></span></a>Currently working on</h2>

<ul>
<li>Update examples</li>
<li>True client API</li>
<li>File support</li>
<li>Using socket.io namespaces</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/mvallerie">mvallerie</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>